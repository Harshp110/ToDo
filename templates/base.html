<!doctype html>
<html lang="en" data-theme="light">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- PWA -->
    <link rel="manifest" href="/static/manifest.json">
    <link rel="icon" href="/static/icons/icon-192.png">
    <meta name="theme-color" content="#000000">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- SortableJS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <title>{% block title %}{% endblock %}</title>

    <style>
        :root[data-theme="dark"] {
            --bg: #0d0d0d;
            --card: #1a1a1a;
            --text: #e2e2e2;
        }

        :root[data-theme="light"] {
            --bg: #ffffff;
            --card: #ffffff;
            --text: #222222;
        }

        body {
            background: var(--bg);
            color: var(--text);
            transition: background 0.3s, color 0.3s;
        }

        .card {
            background: var(--card);
            transition: 0.3s;
        }

        #themeToggle {
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 22px;
        }

        a {
            text-decoration: none;
        }
    </style>

    {% block head %}{% endblock %}
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-dark bg-dark px-3 d-flex justify-content-between">
    <a class="navbar-brand fw-bold text-white">My ToDo+</a>

    <div class="d-flex gap-3">

        <!-- PWA Install Button -->
        <button id="installBtn" class="btn btn-primary btn-sm d-none me-2">
            Install App üì±
        </button>

        <!-- Dashboard -->
        <a href="/dashboard" class="btn btn-sm btn-outline-light me-2">
            <i class="fa-solid fa-chart-line"></i>
        </a>

        <!-- DARK MODE -->
        <button id="themeToggle">üåô</button>

        <!-- LOGOUT -->
        {% if current_user.is_authenticated %}
        <a href="/logout" class="btn btn-danger btn-sm ms-2">Logout</a>
        {% endif %}
    </div>
</nav>

<div class="container py-4">
    {% block content %}{% endblock %}
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- DARK MODE -->
<script>
    const html = document.documentElement;
    const btn = document.getElementById("themeToggle");

    let saved = localStorage.getItem("theme") || "light";
    html.setAttribute("data-theme", saved);
    btn.innerHTML = saved === "dark" ? "‚òÄÔ∏è" : "üåô";

    btn.onclick = () => {
        let current = html.getAttribute("data-theme");
        let next = current === "light" ? "dark" : "light";
        html.setAttribute("data-theme", next);
        localStorage.setItem("theme", next);
        btn.innerHTML = next === "dark" ? "‚òÄÔ∏è" : "üåô";
    };
</script>

<!-- SERVICE WORKER -->
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/static/service-worker.js")
    .then(() => console.log("SW registered"))
    .catch(() => console.log("SW registration failed"));
}
</script>

<!-- A2HS Install -->
<script>
let deferredPrompt;

window.addEventListener("beforeinstallprompt", (e) => {
    e.preventDefault();
    deferredPrompt = e;
    document.getElementById("installBtn").classList.remove("d-none");
});

document.getElementById("installBtn").addEventListener("click", async () => {
    if (!deferredPrompt) return;

    deferredPrompt.prompt();
    const result = await deferredPrompt.userChoice;

    console.log("User choice:", result.outcome);

    deferredPrompt = null;
    document.getElementById("installBtn").classList.add("d-none");
});
</script>

{% block scripts %}{% endblock %}

</body>
</html>
